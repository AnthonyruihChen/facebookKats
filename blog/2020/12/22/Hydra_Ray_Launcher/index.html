<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/Kats/blog/rss.xml" title="Kats Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Kats/blog/atom.xml" title="Kats Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-149862507-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Hydra Ray Launcher | Kats</title><meta data-react-helmet="true" property="og:title" content="Hydra Ray Launcher | Kats"><meta data-react-helmet="true" name="description" content="We are happy to announce that we are adding a Ray Launcher to the Hydra Launchers family."><meta data-react-helmet="true" property="og:description" content="We are happy to announce that we are adding a Ray Launcher to the Hydra Launchers family."><meta data-react-helmet="true" property="og:url" content="https://facebookresearch.github.io/Kats/blog/2020/12/22/Hydra_Ray_Launcher"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/Kats/img/KatsHeroLogo.png"><link data-react-helmet="true" rel="canonical" href="https://facebookresearch.github.io/Kats/blog/2020/12/22/Hydra_Ray_Launcher"><link data-react-helmet="true" rel="alternate" href="https://facebookresearch.github.io/Kats/blog/2020/12/22/Hydra_Ray_Launcher" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://facebookresearch.github.io/Kats/blog/2020/12/22/Hydra_Ray_Launcher" hreflang="x-default"><link rel="stylesheet" href="/Kats/assets/css/styles.99fd060a.css">
<link rel="preload" href="/Kats/assets/js/runtime~main.9e005abd.js" as="script">
<link rel="preload" href="/Kats/assets/js/main.7c3a44f2.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Kats/"><img src="/Kats/img/KatsHeroLogo.png" alt="Project Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/Kats/img/KatsHeroLogo.png" alt="Project Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Kats</strong></a><a class="navbar__item navbar__link" href="/Kats/api/">API</a><a href="https://github.com/facebookresearch/Kats/tree/master/tutorials" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Tutorials</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookresearch/kats" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Kats@GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Kats/"><img src="/Kats/img/KatsHeroLogo.png" alt="Project Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/Kats/img/KatsHeroLogo.png" alt="Project Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Kats</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Kats/api/">API</a></li><li class="menu__list-item"><a href="https://github.com/facebookresearch/Kats/tree/master/tutorials" target="_blank" rel="noopener noreferrer" class="menu__link">Tutorials</a></li><li class="menu__list-item"><a href="https://github.com/facebookresearch/kats" target="_blank" rel="noopener noreferrer" class="menu__link">Kats@GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/Kats/blog/2021/06/13/Hydra_1.1">Hydra 1.1</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/Kats/blog/2020/12/22/Hydra_Ray_Launcher">Hydra Ray Launcher</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/Kats/blog/2020/09/03/Hydra_1.0">Hydra 1.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/Kats/blog/2020/05/04/New-blog">New Hydra blog</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Hydra Ray Launcher</h1><div class="margin-vert--md"><time datetime="2020-12-22T00:00:00.000Z" class="blogPostDate_fNvV">December 21, 2020 ¬∑ 4 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jieru-hu" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://graph.facebook.com/733244046/picture/?height=200&amp;width=200" alt="Jieru Hu"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jieru-hu" target="_blank" rel="noopener noreferrer">Jieru Hu</a></h4><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>We are happy to announce that we are adding a <a href="https://hydra.cc/docs/plugins/ray_launcher" target="_blank" rel="noopener noreferrer">Ray Launcher</a> to the Hydra Launchers family.
Hydra&#x27;s Launcher plugins enable launching to different environments without changing your existing workflows or application code.
The Hydra Ray Launcher can be used to launch your application to a new or existing <a href="https://docs.ray.io/en/master/cluster/launcher.html" target="_blank" rel="noopener noreferrer">Ray cluster</a>,
locally or on AWS. In this post we demonstrate the major functionalities of the Launcher.
For more details on installation and configuration, please check out the <a href="https://hydra.cc/docs/plugins/ray_launcher/" target="_blank" rel="noopener noreferrer">Hydra Ray Launcher documentation</a>.
As always, please <a href="https://github.com/facebookresearch/hydra#community" target="_blank" rel="noopener noreferrer">join our community</a> and give us feedback!</p><p><a href="https://github.com/ray-project/ray" target="_blank" rel="noopener noreferrer">Ray</a> is a simple yet powerful Python library for parallel and distributed programming. Among the many features it provides, Ray comes with a
<a href="https://docs.ray.io/en/master/cluster/launcher.html#ref-automatic-cluster" target="_blank" rel="noopener noreferrer">cluster launcher</a> that can be used to provision resources and start a Ray cluster on top of them.
Hydra Ray Launcher is built on top of the <a href="https://docs.ray.io/en/master/ray-overview/index.html#parallelizing-python-java-functions-with-ray-tasks" target="_blank" rel="noopener noreferrer">Ray Tasks API</a> and the Ray cluster launcher.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="launching-to-a-new-or-existing-aws-cluster"></a>Launching to a new or existing AWS cluster<a class="hash-link" href="#launching-to-a-new-or-existing-aws-cluster" title="Direct link to heading">#</a></h3><p>Hydra Ray Launcher simplifies your experience by allowing the Ray cluster setup to be
configured transparently by Hydra (eliminating the need for an external YAML file while maintaining
the flexibility). Hydra Ray Launcher comes with reasonable default configurations which can be found
<a href="https://hydra.cc/docs/plugins/ray_launcher/#ray_aws-launcher" target="_blank" rel="noopener noreferrer">here</a> (under the heading, ‚ÄúDiscover ray_aws launcher&#x27;s config‚Äù). You can override them in your application
config or from the command line to fit your use case.
The following Ray Launcher example code (e.g., my_app.py) is runnable and can be found <a href="https://github.com/facebookresearch/hydra/tree/master/plugins/hydra_ray_launcher/examples/simple" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Launch your Hydra application to AWS by simply overriding: <code>hydra/launcher=ray_aws</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly commandline"><div tabindex="0" class="prism-code language-commandline codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ python my_app.py hydra/launcher=ray_aws task=1,2 --multirun</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA] Ray Launcher is launching 2 jobs,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA]        #0 : task=1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA]        #1 : task=2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA] Running command: [&#x27;ray&#x27;, &#x27;up&#x27;, &#x27;-y&#x27;, &#x27;/var/folders/n_/9qzct77j68j6n9lh0lw3vjqcn96zxl/T/tmp20qvoy15.yaml&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA] Output: INFO services.py:1090 -- View the Ray dashboard at http://127.0.0.1:8265</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pid=3823)[__main__][INFO] - Executing task 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pid=3822)[__main__][INFO] - Executing task 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA] Stopping cluster now. (stop_cluster=true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA] Deleted the cluster (provider.cache_stopped_nodes=false)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA] Running command: [&#x27;ray&#x27;, &#x27;down&#x27;, &#x27;-y&#x27;, &#x27;/var/folders/n_/9qzct77j68j6n9lh0lw3vjqcn96zxl/T/tmpfm2ems9v.yaml&#x27;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="launching-to-a-new-local-ray-cluster"></a>Launching to a new local Ray Cluster<a class="hash-link" href="#launching-to-a-new-local-ray-cluster" title="Direct link to heading">#</a></h3><p>If you want to do a quick local test,
you can spin up a local Ray cluster at application run time by specifying <code>hydra/launcher=ray</code>.
In this example, we create a new Ray cluster at application time.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly commandline"><div tabindex="0" class="prism-code language-commandline codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ python my_app.py  --multirun hydra/launcher=ray</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA] Ray Launcher is launching 1 jobs, sweep output dir: multirun/2020-12-17/16-11-28</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA] Initializing ray with config: {&#x27;address&#x27;: None}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2020-12-17 16:11:29,340 INFO services.py:1090 -- View the Ray dashboard at http://127.0.0.1:8265</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA]        #0 :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pid=62642) [__main__][INFO] - Executing task 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="launching-to-an-existing-local-ray-cluster"></a>Launching to an existing local Ray Cluster<a class="hash-link" href="#launching-to-an-existing-local-ray-cluster" title="Direct link to heading">#</a></h3><p>You can launch the application on an existing local Ray cluster by configuring the cluster address
and overriding <code>hydra/launcher=ray</code>. In the following example we configure the Ray cluster address
to local ray cluster and Hydra Ray Launcher was able to connect to the existing Ray cluster and
execute the application code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly commandline"><div tabindex="0" class="prism-code language-commandline codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ python my_app.py  --multirun hydra/launcher=ray hydra.launcher.ray.init.address=localhost:6379</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA] Ray Launcher is launching 1 jobs, sweep output dir: multirun/2020-11-10/15-13-32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA] Initializing ray with config: {&#x27;num_cpus&#x27;: None, &#x27;num_gpus&#x27;: None, &#x27;address&#x27;: &#x27;localhost:6379&#x27;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO worker.py:633 -- Connecting to existing Ray cluster at address: 10.30.99.17:6379</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[HYDRA]        #0 :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pid=93358) [__main__][INFO] - Executing task 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Hydra Ray Launcher is built on top of Hydra 1.0 and you have access to all of the benefits Hydra brings:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="parameter-sweeps-and-optimization"></a>Parameter sweeps and optimization<a class="hash-link" href="#parameter-sweeps-and-optimization" title="Direct link to heading">#</a></h3><p>Hyperparameter sweeps are common in machine learning research.
Hydra has built-in grid search and provides several Sweeper plugins for hyperparameter optimization.
Sweepers can be used together with Launchers for sweeping on different computing platforms.
Start from our documentation <a href="https://hydra.cc/docs/tutorials/basic/running_your_app/multi-run/" target="_blank" rel="noopener noreferrer">here</a> to find more.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="config-type-safety"></a>Config type safety<a class="hash-link" href="#config-type-safety" title="Direct link to heading">#</a></h3><p>Modern Hydra applications and Hydra Plugins leverage Structured Configs for config validation,
and Hydra Ray Launcher is no exception. In the following example, we try to override the Ray cluster‚Äôs
autoscaling mode with an illegal value:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly commandline"><div tabindex="0" class="prism-code language-commandline codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ python my_app.py --multirun hydra.launcher.ray.cluster.autoscaling_mode=foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error merging override hydra.launcher.ray.cluster.autoscaling_mode=foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Invalid value &#x27;foo&#x27;, expected one of [default, aggressive]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        full_key: hydra.launcher.ray.cluster.autoscaling_mode</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        reference_type=RayClusterConf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        object_type=RayClusterConf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>That‚Äôs it for now! Please try out the new Hydra Ray Launcher and let us know what you think.
We are always happy to connect with you via <a href="https://github.com/facebookresearch/hydra" target="_blank" rel="noopener noreferrer">GitHub</a> or the <a href="https://hydra-framework.zulipchat.com/" target="_blank" rel="noopener noreferrer">Hydra Chat</a>.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/Kats/blog/tags/hydra">Hydra</a><a class="margin-horiz--sm" href="/Kats/blog/tags/ray">Ray</a><a class="margin-horiz--sm" href="/Kats/blog/tags/plugin">Plugin</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Kats/blog/2021/06/13/Hydra_1.1"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">¬´ Hydra 1.1</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Kats/blog/2020/09/03/Hydra_1.0"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Hydra 1.0 ¬ª</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#launching-to-a-new-or-existing-aws-cluster" class="table-of-contents__link">Launching to a new or existing AWS cluster</a></li><li><a href="#launching-to-a-new-local-ray-cluster" class="table-of-contents__link">Launching to a new local Ray Cluster</a></li><li><a href="#launching-to-an-existing-local-ray-cluster" class="table-of-contents__link">Launching to an existing local Ray Cluster</a></li><li><a href="#parameter-sweeps-and-optimization" class="table-of-contents__link">Parameter sweeps and optimization</a></li><li><a href="#config-type-safety" class="table-of-contents__link">Config type safety</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebookresearch/Kats" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kats@GitHub</a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noreferrer noopener" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noreferrer noopener" class="footer__link-item">Terms</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy" target="_blank" rel="noreferrer noopener" class="footer__link-item">Cookies</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="https://docusaurus.io/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="https://docusaurus.io/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright ¬© 2021 Facebook, Inc.</div></div></div></footer></div>
<script src="/Kats/assets/js/runtime~main.9e005abd.js"></script>
<script src="/Kats/assets/js/main.7c3a44f2.js"></script>
</body>
</html>